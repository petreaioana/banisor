<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Simulator Biscuiți FinKids</title>
  <style>
    /* Stiluri globale și fundaluri */
    body {
      margin: 0;
      font-family: 'Comic Sans MS', sans-serif;
      background-color: #fdf5e6;
    }
    #top-bar {
      background-color: #fdd26e;
      padding: 0.5rem 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
    }
    #top-bar .lei-display {
      margin-left: auto;
    }
    .screen {
      display: none;
      min-height: calc(100vh - 50px);
      padding: 1rem;
      box-sizing: border-box;
      position: relative;
    }
    .active-screen {
      display: block;
    }
    .scene-shop {
      background-image: url('shop_background.png');
      background-size: cover;
      background-position: center;
    }
    .scene-kitchen {
      background-image: url('kitchen_background.png');
      background-size: cover;
      background-position: center;
    }

    /* Fundal pentru blat de lucru la etapa de mixare */
    .scene-worktop {
      background-image: url('worktop_background.png');
      background-size: cover;
      background-position: center;
    }
    .order-ticket {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: #fffbee;
      border: 2px solid #e6a937;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: bold;
    }
    .client {
      font-size: 4rem;
      margin-top: 2rem;
      animation: clientEnter 1s ease forwards;
      opacity: 0;
    }
    @keyframes clientEnter {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .speech-bubble {
      position: absolute;
      top: 1.5rem;
      left: 6rem;
      background: #fffbee;
      border: 2px solid #e6a937;
      padding: 0.5rem;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .panel {
      background-color: rgba(255, 255, 255, 0.85);
      border: 2px solid #e6a937;
      border-radius: 10px;
      padding: 1rem;
      margin-top: 2rem;
      max-width: 300px;
    }
    button {
      background-color: #f5a623;
      border: none;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background-color: #e58b17;
    }
    .banisor {
      margin-top: 2rem;
      text-align: center;
    }
    .banisor img {
      width: 80px;
      height: 80px;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
    /* Layout pentru ingrediente */
    /* Masa cu ingrediente pentru amestecare */
    .ingredients-board {
      position: absolute;
      left: 0;
      bottom: 12vh;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .ingredient-slot {
      position: relative;
      width: 80px;
      height: 80px;
      border: 2px solid #e6a937;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: grab;
      opacity: 0;
      animation: popIn 0.6s forwards;
    }
    .ingredient-slot.used {
      opacity: 0.4;
    }
    .ingredient-slot img {
      width: 70px;
      height: 70px;
    }
    .ingredient-name {
      text-align: center;
      font-size: 0.75rem;
      margin-top: 0.2rem;
      width: 80px;
    }
    @keyframes popIn {
      from { transform: translateY(30px) scale(0.8); opacity: 0; }
      to   { transform: translateY(0)     scale(1);   opacity: 1; }
    }
    /* Bolul pentru aluat */
    .bowl {
      /* zona de drop pentru aluat: suprapusă peste bolul ilustrat din fundal */
      position: absolute;
      /* poziționat în jurul centrului inferior al ecranului; se adaptează la dimensiune */
      top: 58%;
      left: 50%;
      transform: translate(-50%, -40%);
      width: 40%;
      height: 32%;
      border: 2px dashed #d3994c;
      border-bottom-left-radius: 50%;
      border-bottom-right-radius: 50%;
      background-color: rgba(249, 213, 163, 0.4);
      pointer-events: auto;
    }
    .drop-in {
      animation: drop-in 0.6s ease forwards;
    }
    @keyframes drop-in {
      from { transform: translateY(-30px) scale(0.6); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }
    /* Progres bar pentru coacere */
    .progress-container {
      width: 60%;
      height: 20px;
      background: #fffbee;
      border: 2px solid #e6a937;
      border-radius: 10px;
      margin: 5rem auto;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background: #f5a623;
      border-radius: 10px;
      transition: width 0.1s;
    }
    /* Container biscuite și toppinguri */
    .cookie-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 3rem auto 1rem auto;
    }
    .cookie-base {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background-color: #f5c57e;
      border: 4px solid #d3994c;
      margin: 0 auto;
    }
    .toppings-container {
      display: flex;
      justify-content: center;
      gap: 0.8rem;
      margin-top: 1rem;
    }
    .topping-img {
      width: 40px;
      height: 40px;
      cursor: grab;
    }
    /* Bara de stații (Mixare, Coacere, Decorare) */
    .station-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 0.5rem;
      background: #333;
      color: #fff;
      font-size: 0.9rem;
    }
    .station-bar .station {
      padding: 0.3rem 1rem;
      border-radius: 4px;
      background: #555;
    }
    .station-bar .active {
      background: #f5a623;
      color: #000;
    }
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
    }
    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: confetti-fall 3s linear forwards;
    }
    @keyframes confetti-fall {
      0% { transform: translateY(-10%); opacity: 1; }
      100% { transform: translateY(110vh); opacity: 0; }
    }

    /* Clientul intră de la ușă (din dreapta) și merge spre tejghea */
    .client-right {
      position: absolute;
      bottom: 6rem;
      right: 3rem;
      font-size: 5rem;
      animation: clientEnterFromRight 1s forwards;
      opacity: 0;
      z-index: 10;
    }
    @keyframes clientEnterFromRight {
      from { transform: translateX(200%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Banisor plasat după tejghea */
    .banisor-counter {
      position: absolute;
      bottom: 2rem;
      left: 2rem;
      text-align: center;
    }
    .banisor-counter img {
      width: 100px;
      height: 100px;
      animation: bounce 2s infinite;
    }
    /* Stiluri pentru animația cuptorului */
.oven-animation-container {
  position: relative;
  width: 400px;
  height: 300px;
  margin: 2rem auto;
}
.oven-image {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}
.baking-tray {
  position: absolute;
  width: 280px;
  height: 150px;
  background-color: #c0c0c0;
  border: 2px solid #8b8b8b;
  border-radius: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
  /* Poziția inițială a tăvii */
  top: 100px;
  left: -290px;
  /* Animația care durează 3 secunde, la fel ca timer-ul */
  animation: bake-animation 3s ease-in-out forwards;

  /* Tava este vizibilă doar când ușa cuptorului este deschisă; controlată din JS */
  opacity: 1;
  transition: opacity 0.2s ease;
}
.cookie-on-tray {
  width: 100px;
  height: 100px;
}
@keyframes bake-animation {
  0% {
    /* Tava este afară, în stânga */
    transform: translateX(0);
  }
  20% {
    /* Tava intră în cuptor */
    transform: translateX(410px);
  }
  80% {
    /* Tava stă în cuptor (în timpul coacerii) */
    transform: translateX(410px);
  }
  100% {
    /* Tava iese din cuptor */
    transform: translateX(0);
  }
}
  </style>
</head>
<body>
  <div id="top-bar"><span class="lei-display">💰 <span id="lei-count">0</span></span></div>
  <main id="cookie-game"></main>
  <script>
    // Funcții de stare și utilitare
    function loadState() {
      try {
        const data = localStorage.getItem('cookie_profile');
        return data ? JSON.parse(data) : { lei: 0, progress: { cookies: { day: 1, profitBest: 0 } } };
      } catch (e) {
        return { lei: 0, progress: { cookies: { day: 1, profitBest: 0 } } };
      }
    }
    function saveState(s) {
      localStorage.setItem('cookie_profile', JSON.stringify(s));
    }
    let state = loadState();

// -- Variabile pentru sistemul de decizii financiare --
let financialStep = 0;
// Parametri care pot influența profitul (simplificat)
let ingredientQuality = 2; // 1=ieftin, 2=mediu, 3=premium
let equipmentLevel = 0;    // 0=basic,1=mixer,2=cuptor electric
let priceChoice = 2;       // 1=mic,2=mediu,3=mare
let marketingLevel = 0;    // 0=none,1=mic,2=mare
let hasInsurance = false;
let loanAmount = 0;

// Definim deciziile financiare ca o listă de obiecte
const financialDecisions = [
  {
    title: 'Ce fel de ingrediente folosim?',
    description: 'Alege cu ce vrei să faci biscuiții. Ingrediente diferite au calități și prețuri diferite.',
    options: [
      {
        text: 'Ingrediente ieftine (10 lei) – biscuiții pot fi mai puțin gustoși',
        effect: () => {
          state.lei -= 10;
          ingredientQuality = 1;
          alert('Ai ales ingrediente ieftine. Biscuiții s-ar putea să nu fie la fel de buni, dar costă mai puțin.');
        }
      },
      {
        text: 'Ingrediente normale (20 lei) – echilibru între cost și gust',
        effect: () => {
          state.lei -= 20;
          ingredientQuality = 2;
          alert('Ai ales ingrediente normale. Biscuiții vor fi buni, iar costul este rezonabil.');
        }
      },
      {
        text: 'Ingrediente de calitate (30 lei) – biscuiți foarte gustoși',
        effect: () => {
          state.lei -= 30;
          ingredientQuality = 3;
          alert('Ai ales ingrediente de calitate. Biscuiții vor fi delicioși, chiar dacă ai cheltuit mai mult.');
        }
      }
    ]
  },
  {
    title: 'Ce unelte folosim?',
    description: 'Unelte mai bune ne ajută să facem mai mulți biscuiți. Ce alegi?',
    options: [
      {
        text: 'Fără unelte noi – facem puțini biscuiți',
        effect: () => {
          equipmentLevel = 0;
          alert('Nu ai cumpărat unelte noi. Vom face doar câțiva biscuiți deodată.');
        }
      },
      {
        text: 'Mixer simplu (50 lei) – facem mai mult aluat',
        effect: () => {
          if (state.lei >= 50) {
            state.lei -= 50;
            equipmentLevel = 1;
            alert('Ai cumpărat un mixer simplu. Putem prepara mai mult aluat și mai mulți biscuiți.');
          } else {
            alert('Nu ai suficienți lei pentru mixer.');
          }
        }
      },
      {
        text: 'Cuptor electric (200 lei) – coacem mulți biscuiți rapid',
        effect: () => {
          if (state.lei >= 200) {
            state.lei -= 200;
            equipmentLevel = 2;
            alert('Ai cumpărat un cuptor electric. Vom coace multe biscuiți rapid!');
          } else {
            alert('Nu ai suficienți lei pentru cuptor.');
          }
        }
      }
    ]
  },
  {
    title: 'Cât costă un biscuit?',
    description: 'Prețul trebuie să fie potrivit pentru ca oamenii să cumpere. Ce alegi?',
    options: [
      {
        text: 'Preț mic (2 lei) – vom vinde rapid, dar câștigăm puțin',
        effect: () => {
          priceChoice = 1;
          alert('Ai ales un preț mic. Vom vinde repede, dar fiecare biscuite aduce puțini lei.');
        }
      },
      {
        text: 'Preț mediu (5 lei) – vinde bine și câștigăm bine',
        effect: () => {
          priceChoice = 2;
          alert('Ai ales un preț mediu. Biscuiții se vor vinde bine și vom câștiga frumos.');
        }
      },
      {
        text: 'Preț mare (10 lei) – puțini clienți, dar câștigăm mai mult pe bucată',
        effect: () => {
          priceChoice = 3;
          alert('Ai ales un preț mare. Mai puțini oameni vor cumpăra, dar profitul pe biscuite crește.');
        }
      }
    ]
  },
  {
    title: 'Facem reclamă?',
    description: 'Reclama ne poate aduce clienți noi. Cât vrei să investești?',
    options: [
      {
        text: 'Fără reclamă – vin doar clienții care ne cunosc',
        effect: () => {
          marketingLevel = 0;
          alert('Nu ai cheltuit pe reclamă. Oamenii care ne cunosc deja vor veni.');
        }
      },
      {
        text: 'Pliante (30 lei) – atragem câțiva clienți noi',
        effect: () => {
          if (state.lei >= 30) {
            state.lei -= 30;
            marketingLevel = 1;
            alert('Ai tipărit pliante. Vor veni câțiva clienți noi.');
          } else {
            alert('Nu ai suficienți lei pentru pliante.');
          }
        }
      },
      {
        text: 'Reclame online (100 lei) – atragem mulți clienți',
        effect: () => {
          if (state.lei >= 100) {
            state.lei -= 100;
            marketingLevel = 2;
            alert('Ai plătit reclame pe internet. Mulți clienți vor afla de biscuiții tăi!');
          } else {
            alert('Nu ai suficienți lei pentru reclame online.');
          }
        }
      }
    ]
  },
  {
    title: 'Ce facem cu banii?',
    description: 'După ce vindem biscuiți, putem alege să economisim, să reinvestim sau să cheltuim pe ceva pentru noi.',
    options: [
      {
        text: 'Economisim – păstrăm banii pentru mai târziu',
        effect: () => {
          const gain = Math.floor(state.lei * 0.05);
          state.lei += gain;
          alert('Ai ales să economisești. Banii tăi vor crește puțin (cu 5%) și îi vei avea pentru mai târziu.');
        }
      },
      {
        text: 'Reinvestim – cumpărăm mai multe ingrediente și unelte',
        effect: () => {
          alert('Ai ales să reinvestești. Folosim banii pentru a cumpăra ingrediente sau unelte ca să câștigăm mai mult în viitor.');
        }
      },
      {
        text: 'Cumpărăm o jucărie – cheltuim pentru plăcerea noastră',
        effect: () => {
          const spent = Math.min(20, state.lei);
          state.lei -= spent;
          alert('Ai ales să cumperi o jucărie. Este distractiv acum, dar ai mai puțini bani pentru afacere.');
        }
      }
    ]
  },
  {
    title: 'Cum ne protejăm de surprize?',
    description: 'Uneori se întâmplă lucruri neprevăzute (ploaie, se strică cuptorul). Cum ne pregătim?',
    options: [
      {
        text: 'Împrumut (100 lei) – avem bani acum, dar trebuie să dăm mai mult înapoi',
        effect: () => {
          loanAmount += 100;
          state.lei += 100;
          alert('Ai luat un împrumut. Acum ai bani, dar va trebui să îi returnezi cu dobândă.');
        }
      },
      {
        text: 'Asigurare (20 lei) – ne protejează când apar probleme',
        effect: () => {
          if (state.lei >= 20) {
            state.lei -= 20;
            hasInsurance = true;
            alert('Ai cumpărat asigurare. Dacă se întâmplă ceva rău, nu pierzi toți banii.');
          } else {
            alert('Nu ai suficienți lei pentru asigurare.');
          }
        }
      },
      {
        text: 'Nu facem nimic – riscăm să pierdem bani',
        effect: () => {
          alert('Nu ai ales protecție. Dacă apare un eveniment neprevăzut, poți pierde bani.');
        }
      }
    ]
  }
];

// Afișează un ecran de decizie financiară după servire
function showFinancialDecision() {
  clearGame();
  // dacă am parcurs toate deciziile, revenim la meniu și pregătim o nouă comandă
  if (financialStep >= financialDecisions.length) {
    financialStep = 0;
    showOrderScreen();
    return;
  }
  const dec = financialDecisions[financialStep];
  const root = document.getElementById('cookie-game');
  const screen = document.createElement('div');
  screen.className = 'screen active-screen scene-shop';
  const title = document.createElement('h2');
  title.textContent = dec.title;
  screen.appendChild(title);
  const desc = document.createElement('p');
  desc.textContent = dec.description;
  screen.appendChild(desc);
  // container pentru butoane
  dec.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.textContent = opt.text;
    btn.addEventListener('click', () => {
      opt.effect();
      updateLeiDisplay();
      saveState(state);
      // trecem la următoarea decizie
      financialStep++;
      showFinancialDecision();
    });
    screen.appendChild(btn);
  });
  screen.appendChild(createBanisor('Alege una dintre opțiuni pentru a învăța despre bani!'));
  root.appendChild(screen);
}
    function updateLeiDisplay() {
      document.getElementById('lei-count').textContent = state.lei;
    }
    function addLei(amount) {
      state.lei += amount;
      updateLeiDisplay();
      saveState(state);
    }
    function updateCookieProgress(data) {
      const prog = state.progress.cookies || {};
      state.progress.cookies = { ...prog, ...data };
      saveState(state);
    }
    // Date de joc
    const DECORATIONS = {
      'ciocolată': { piece: 'chocolate_chips.png', final: 'cookie_choco.png' },
      'fructe':    { piece: 'strawberries.png',    final: 'cookie_strawberry.png' },
      'bombonele': { piece: 'sprinkles.png',       final: 'cookie_sprinkle.png' }
    };
    const ORDERS = [
      { decoration: 'ciocolată' },
      { decoration: 'fructe' },
      { decoration: 'bombonele' }
    ];
    const CLIENTS = [
      { emoji: '👧', name: 'Maria' },
      { emoji: '👦', name: 'Ion' },
      { emoji: '🐻', name: 'Ursuleț' },
      { emoji: '🦊', name: 'Vulpita' }
    ];
    let currentOrder, currentClient;
    // stocăm ingrediente suplimentare adăugate în aluat (cacao sau cocos)
    let currentExtras = { cacao: false, cocos: false };
    // Helper pentru curățarea ecranului
    function clearGame() {
      const root = document.getElementById('cookie-game');
      root.innerHTML = '';
    }
    // Bara de stații
    function renderStationBar(active) {
      document.querySelectorAll('.station-bar').forEach(el => el.remove());
      const bar = document.createElement('div');
      bar.className = 'station-bar';
      ['Mixare', 'Coacere', 'Decorare'].forEach(name => {
        const div = document.createElement('div');
        div.className = 'station';
        div.textContent = name;
        if (name === active) div.classList.add('active');
        bar.appendChild(div);
      });
      document.body.appendChild(bar);
    }
    // Mascota Banisor
    function createBanisor(text) {
      const cont = document.createElement('div');
      cont.className = 'banisor';
      const img = document.createElement('img');
      img.src = 'banisor_character.png';
      img.alt = 'Banisor';
      cont.appendChild(img);
      const msg = document.createElement('p');
      msg.textContent = text;
      cont.appendChild(msg);
      return cont;
    }
    // Afișăm ecranul de comandă
    function showOrderScreen() {
      clearGame();
      renderStationBar('');
      currentOrder = ORDERS[Math.floor(Math.random() * ORDERS.length)];
      currentClient = CLIENTS[Math.floor(Math.random() * CLIENTS.length)];
      const root = document.getElementById('cookie-game');
      const screen = document.createElement('div');
      screen.className = 'screen active-screen scene-shop';
      const orderNumber = (state.progress.cookies && state.progress.cookies.day) ? state.progress.cookies.day : 1;
      const ticket = document.createElement('div');
      ticket.className = 'order-ticket';
      ticket.textContent = 'Comanda ' + orderNumber;
      screen.appendChild(ticket);
      // Clientul intră de la dreapta și se oprește în fața tejghelei
      const clientEl = document.createElement('div');
      clientEl.className = 'client-right';
      clientEl.textContent = currentClient.emoji;
      screen.appendChild(clientEl);
      // Bula de discuție cu imaginea comenzii (poziționată în colțul stânga sus)
      const bubble = document.createElement('div');
      bubble.className = 'speech-bubble';
      // Repozitionăm bula cu CSS inline pentru a fi în colțul din dreapta sus
      bubble.style.position = 'absolute';
      bubble.style.top = '1rem';
      // poziționăm bula în colțul din dreapta sus pentru a nu acoperi panoul
      bubble.style.right = '1rem';
      bubble.style.left = 'auto';
      // Setăm dimensiuni fixe pentru bulă ca să nu se întindă pe tot ecranul
      bubble.style.width = '120px';
      bubble.style.height = '80px';
      bubble.style.display = 'flex';
      bubble.style.justifyContent = 'center';
      bubble.style.alignItems = 'center';
      const oImg = document.createElement('img');
      oImg.src = DECORATIONS[currentOrder.decoration].final;
      oImg.style.width = '80px';
      oImg.style.height = '80px';
      bubble.appendChild(oImg);
      screen.appendChild(bubble);
      // Panou cu mesaj de întâmpinare și explicație
      const panel = document.createElement('div');
      panel.className = 'panel';
      panel.innerHTML = '<strong>Bun venit la FinKids Biscuiți!</strong><br>' + currentClient.name + ' dorește un biscuite cu decor de <em>' + currentOrder.decoration + '</em>.<br>Banisor te așteaptă după tejghea să îi iei comanda!';
      screen.appendChild(panel);
      // Butonul pentru a începe etapa de mixare
      const btn = document.createElement('button');
      btn.textContent = 'Intră în bucătărie';
      btn.addEventListener('click', showMixScreen);
      screen.appendChild(btn);
      // Banisor plasat după tejghea (fără mesaj lung)
      const ban = document.createElement('div');
      ban.className = 'banisor-counter';
      const bImg = document.createElement('img');
      bImg.src = 'banisor_character.png';
      bImg.alt = 'Banisor';
      ban.appendChild(bImg);
      screen.appendChild(ban);
      root.appendChild(screen);
    }
    // Etapa de amestecare
    function showMixScreen() {
      clearGame();
      // resetăm variabila globală extras pentru o nouă comandă
      currentExtras = { cacao: false, cocos: false };
      renderStationBar('Mixare');
      const root = document.getElementById('cookie-game');
      const screen = document.createElement('div');
      // Folosim fundalul blatului de lucru pentru etapa de mixare
      screen.className = 'screen active-screen scene-worktop';
      const title = document.createElement('h2');
      title.textContent = 'Pregătirea aluatului';
      const desc = document.createElement('p');
      desc.textContent = 'Trage ingredientele de pe masă în bol pentru a pregăti aluatul.';
      screen.appendChild(title);
      screen.appendChild(desc);
      const bowl = document.createElement('div');
      bowl.className = 'bowl';
      let addedBase = 0;
      // ține evidența ingredientelor extra adăugate
      const mixExtras = { cacao: false, cocos: false };
      const baseKeys = ['faina', 'zahar', 'lapte'];
      let mixBtnShown = false;
      bowl.addEventListener('dragover', e => e.preventDefault());
      bowl.addEventListener('drop', e => {
        e.preventDefault();
        const key = e.dataTransfer.getData('text/plain');
        const item = document.querySelector('.ingredient-slot[data-key="' + key + '"]');
        if (item && !item.classList.contains('used')) {
          item.classList.add('used');
          if (baseKeys.includes(key)) addedBase++;
          if (key === 'cacao') mixExtras.cacao = true;
          if (key === 'cocos') mixExtras.cocos = true;
          const ing = ingredientsMaster.find(obj => obj.key === key);
          if (ing) {
            const dropImg = document.createElement('img');
            dropImg.src = ing.img;
            dropImg.className = 'drop-in';
            // dimensionăm piesele în funcție de dimensiunea bolului pentru a nu fi prea mari
            const rect = bowl.getBoundingClientRect();
            // dimensiunea piesei este 12% din lățimea bolului, dar nu mai mult de 50px
            const size = Math.min(rect.width * 0.12, 50);
            dropImg.style.width = size + 'px';
            dropImg.style.height = size + 'px';
            // distribuim aleator imaginile în interiorul bolului
            const x = rect.width * 0.15 + Math.random() * rect.width * 0.7;
            const y = rect.height * 0.1 + Math.random() * rect.height * 0.5;
            dropImg.style.left = x + 'px';
            dropImg.style.top = y + 'px';
            bowl.appendChild(dropImg);
          }
          if (addedBase >= 3 && !mixBtnShown) {
            mixBtn.style.display = 'inline-block';
            mixBtnShown = true;
          }
        }
      });
      screen.appendChild(bowl);
      const ingredientsMaster = [
        { key: 'faina',  img: 'flour.png',   name: 'Făină' },
        { key: 'zahar',  img: 'sugar.png',   name: 'Zahăr' },
        { key: 'lapte',  img: 'milk.png',    name: 'Lapte' },
        { key: 'cacao',  img: 'cacao.png',   name: 'Cacao' },
        { key: 'cocos',  img: 'coconut.png', name: 'Nucă de cocos' }
      ];
      const board = document.createElement('div');
      board.className = 'ingredients-board';
      ingredientsMaster.forEach((ing, idx) => {
        // Fiecare ingredient este plasat într-un bol circular cu etichetă
        const slot = document.createElement('div');
        slot.className = 'ingredient-slot';
        slot.dataset.key = ing.key;
        // setăm o întârziere a animației pentru efect pop-in
        slot.style.animationDelay = (idx * 0.1) + 's';
        const img = document.createElement('img');
        img.src = ing.img;
        img.alt = ing.name;
        img.setAttribute('draggable', 'true');
        img.addEventListener('dragstart', ev => {
          ev.dataTransfer.setData('text/plain', ing.key);
        });
        slot.appendChild(img);
        // etichetă ingredient
        const label = document.createElement('div');
        label.className = 'ingredient-name';
        label.textContent = ing.name;
        // container pentru slot și etichetă
        const wrapper = document.createElement('div');
        wrapper.style.display = 'flex';
        wrapper.style.flexDirection = 'column';
        wrapper.style.alignItems = 'center';
        wrapper.appendChild(slot);
        wrapper.appendChild(label);
        board.appendChild(wrapper);
      });
      screen.appendChild(board);
      const mixBtn = document.createElement('button');
      mixBtn.textContent = 'Amestecă aluatul și coace';
      // ascuns inițial; poziționat în partea de jos a ecranului
      mixBtn.style.display = 'none';
      mixBtn.style.position = 'absolute';
      mixBtn.style.bottom = '1.2rem';
      mixBtn.style.left = '50%';
      mixBtn.style.transform = 'translateX(-50%)';
      mixBtn.addEventListener('click', () => {
        // salvăm extra în variabila globală înainte de coacere
        currentExtras = { ...mixExtras };
        showBakeScreen();
      });
      screen.appendChild(mixBtn);
      screen.appendChild(createBanisor('Adaugă făină, zahăr, lapte și, dacă dorești, cacao sau nucă de cocos.'));
      root.appendChild(screen);
    }
    // Coacerea (CU ANIMAȚIE NOUĂ)
function showBakeScreen() {
  clearGame();
  renderStationBar('Coacere');
  const root = document.getElementById('cookie-game');
  const screen = document.createElement('div');
  // Folosește scena de bucătărie pentru coacere
  screen.className = 'screen active-screen scene-kitchen';
  
  const title = document.createElement('h2');
  title.textContent = 'Coacerea biscuitului';
  screen.appendChild(title);

  // --- Noul container pentru animația cuptorului ---
  const ovenContainer = document.createElement('div');
  ovenContainer.className = 'oven-animation-container';

  // Imaginea cuptorului: pornim cu varianta cu ușa deschisă
  const ovenImg = document.createElement('img');
  ovenImg.src = 'oven_open.png';
  ovenImg.alt = 'Cuptor';
  ovenImg.className = 'oven-image';
  ovenContainer.appendChild(ovenImg);

  // Tava care va fi animată
  const tray = document.createElement('div');
  tray.className = 'baking-tray';
  
  // Imaginea biscuitului de pe tavă
  const cookieImg = document.createElement('img');
  // Păstrăm logica pentru a alege imaginea corectă a biscuitului
  let bakeSrc = 'cookie_bake_plain.png';
  if (currentExtras.cacao) bakeSrc = 'cookie_bake_cacao.png';
  if (currentExtras.cocos) bakeSrc = 'cookie_bake_cocos.png';
  cookieImg.src = bakeSrc;
  cookieImg.alt = 'Biscuite pe tavă';
  cookieImg.className = 'cookie-on-tray';
  tray.appendChild(cookieImg);
  ovenContainer.appendChild(tray);

  screen.appendChild(ovenContainer);
  // --- Sfârșitul containerului de animație ---

  // bară de progres pentru coacere
  const prog = document.createElement('div');
  prog.className = 'progress-container';
  const bar = document.createElement('div');
  bar.className = 'progress-bar';
  prog.appendChild(bar);
  screen.appendChild(prog);
  
  screen.appendChild(createBanisor('Așteaptă puțin până se coace biscuitele.'));
  root.appendChild(screen);
  
  let elapsed = 0;
  // Timer-ul de 3 secunde este păstrat pentru a se sincroniza cu animația
  const timer = setInterval(() => {
    elapsed += 100;
    bar.style.width = Math.min(100, (elapsed / 3000) * 100) + '%';
    if (elapsed >= 3000) {
      clearInterval(timer);
      showDecorateScreen();
    }
  }, 100);

  // Schimbăm imaginea cuptorului pentru a simula închiderea și deschiderea ușii
  // Ușa se închide la 0.6s după start (20% din 3s), apoi se redeschide către final
  setTimeout(() => { ovenImg.src = 'oven_closed.png'; }, 600);
  setTimeout(() => { ovenImg.src = 'oven_open.png'; }, 2400);

  // Controlăm vizibilitatea tăvii: dispare când ușa este închisă și reapare când ușa se redeschide
  setTimeout(() => { tray.style.opacity = '0'; }, 600);
  setTimeout(() => { tray.style.opacity = '1'; }, 2400);
}

    // Decorarea
    function showDecorateScreen() {
      clearGame();
      renderStationBar('Decorare');
      const root = document.getElementById('cookie-game');
      const screen = document.createElement('div');
      screen.className = 'screen active-screen scene-kitchen';
      const title = document.createElement('h2');
      title.textContent = 'Ornarea biscuitului';
      const desc = document.createElement('p');
      desc.textContent = 'Trage decorațiunile pe biscuite.';
      screen.appendChild(title);
      screen.appendChild(desc);
      const cookieContainer = document.createElement('div');
      cookieContainer.className = 'cookie-container';
      const cookieBase = document.createElement('div');
      cookieBase.className = 'cookie-base';
      cookieContainer.appendChild(cookieBase);
      const dropZone = document.createElement('div');
      dropZone.style.position = 'absolute';
      dropZone.style.top = '0';
      dropZone.style.left = '0';
      dropZone.style.width = '100%';
      dropZone.style.height = '100%';
      cookieContainer.appendChild(dropZone);
      let pieces = 0;
      let serveBtn;
      dropZone.addEventListener('dragover', e => e.preventDefault());
      dropZone.addEventListener('drop', e => {
        e.preventDefault();
        const decor = e.dataTransfer.getData('text/plain');
        // verificăm dacă decorul tras este cel corect
        if (decor === currentOrder.decoration) {
          // adăugăm o singură piesă în centrul biscuitului
          const part = document.createElement('img');
          part.src = DECORATIONS[currentOrder.decoration].piece;
          part.className = 'topping-img';
          part.style.position = 'absolute';
          // centrăm imaginea de topping pe biscuite (180px baza, 30px topping)
          part.style.left = '75px';
          part.style.top = '75px';
          part.style.width = '30px';
          part.style.height = '30px';
          cookieContainer.appendChild(part);
          pieces++;
          // după o singură piesă, afișăm biscuitele final și butonul de servire
          if (pieces >= 1) {
            setTimeout(() => {
              cookieContainer.innerHTML = '';
              const finalImg = document.createElement('img');
              finalImg.src = DECORATIONS[currentOrder.decoration].final;
              finalImg.style.width = '180px';
              finalImg.style.height = '180px';
              finalImg.style.borderRadius = '50%';
              cookieContainer.appendChild(finalImg);
              serveBtn.style.display = 'inline-block';
            }, 500);
          }
        } else {
          alert('Acest decor nu corespunde comenzii!');
        }
      });
      screen.appendChild(cookieContainer);
      const toppings = document.createElement('div');
      toppings.className = 'toppings-container';
      // generăm o singură imagine de topping de tras în bol
      const t = document.createElement('img');
      t.src = DECORATIONS[currentOrder.decoration].piece;
      t.className = 'topping-img';
      t.setAttribute('draggable', 'true');
      t.addEventListener('dragstart', ev => {
        ev.dataTransfer.setData('text/plain', currentOrder.decoration);
      });
      toppings.appendChild(t);
      screen.appendChild(toppings);
      serveBtn = document.createElement('button');
      serveBtn.textContent = 'Servește biscuitele';
      serveBtn.style.display = 'none';
      serveBtn.addEventListener('click', showServeScreen);
      screen.appendChild(serveBtn);
      screen.appendChild(createBanisor('Decorează cu grijă biscuitele. Folosește cinci bucăți.'));
      root.appendChild(screen);
    }
    // Servirea
    function showServeScreen() {
      clearGame();
      document.querySelectorAll('.station-bar').forEach(el => el.remove());
      const root = document.getElementById('cookie-game');
      const screen = document.createElement('div');
      screen.className = 'screen active-screen scene-shop';
      const title = document.createElement('h2');
      title.textContent = 'Livrarea biscuitului';
      const msg = document.createElement('p');
      msg.textContent = currentClient.name + ' a primit biscuitele și este foarte fericit!';
      screen.appendChild(title);
      screen.appendChild(msg);
      const finalImg = document.createElement('img');
      finalImg.src = DECORATIONS[currentOrder.decoration].final;
      finalImg.style.width = '180px';
      finalImg.style.height = '180px';
      finalImg.style.borderRadius = '50%';
      screen.appendChild(finalImg);
      // Dăm o recompensă mai mică (3 lei) pentru a încuraja investițiile ulterioare
      addLei(3);
      const nextDay = (state.progress.cookies.day || 1) + 1;
      // actualizăm cel mai bun profit cu noua valoare de 3 lei dacă este mai mare
      const best = Math.max(state.progress.cookies.profitBest || 0, 3);
      updateCookieProgress({ day: nextDay, profitBest: best });
      const panel = document.createElement('div');
      panel.className = 'panel';
      panel.innerHTML = '<strong>Rezumat:</strong><br>Mixare: <span style="color:#d87b00">100%</span><br>Coacere: <span style="color:#d87b00">100%</span><br>Decorare: <span style="color:#d87b00">100%</span><br><br>Total lei: <span style="color:#d87b00">' + state.lei + '</span>';
      screen.appendChild(panel);
      const againBtn = document.createElement('button');
      againBtn.textContent = 'Prepară alt biscuit';
      againBtn.addEventListener('click', showOrderScreen);
      const exitBtn = document.createElement('button');
      exitBtn.textContent = 'Închide jocul';
      exitBtn.addEventListener('click', () => { alert('Mulțumim că ai jucat! Închide fila pentru a ieși.'); });
      screen.appendChild(againBtn);
      screen.appendChild(exitBtn);
      screen.appendChild(createBanisor('Bravo! Ai făcut un biscuite delicios!'));
      root.appendChild(screen);
      createConfetti();
      // După servire, prezentăm o decizie financiară pentru educație
      setTimeout(() => {
        showFinancialDecision();
      }, 500); // lăsăm puțin timp pentru confetti
    }
    // Confetti
    function createConfetti() {
      const colors = ['#f9c74f', '#f9844a', '#90be6d', '#fda65f', '#87b6e5', '#f27ba5'];
      const container = document.createElement('div');
      container.className = 'confetti-container';
      for (let i = 0; i < 40; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = Math.random() * 100 + '%';
        piece.style.animationDelay = (Math.random() * 0.5) + 's';
        container.appendChild(piece);
      }
      document.body.appendChild(container);
      setTimeout(() => {
        if (document.body.contains(container)) document.body.removeChild(container);
      }, 3000);
    }
    // Pornim jocul după încărcarea paginii
    window.addEventListener('DOMContentLoaded', () => {
      updateLeiDisplay();
      showOrderScreen();
    });
  </script>
</body>
</html>